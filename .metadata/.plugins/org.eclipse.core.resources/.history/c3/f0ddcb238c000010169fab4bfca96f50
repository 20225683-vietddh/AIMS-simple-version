package model;

import java.util.*;

public class Cart {
	private Map<Media, Integer> itemsOrdered = new HashMap<Media, Integer>();
	final int MAX_NUMBER_ORDERED = 20;
	
	public Map<Media, Integer> getItemsOrdered() {
		return this.itemsOrdered;
	}
	
	public void addMedia(Media media, int quantity) {
		if (media == null || quantity <= 0) {
			System.out.println("‚ùå Invalid media or the quantity must be greater than 0.");
			return;
		}
		
		int currentTotal = getTotalItems();
		if (currentTotal + quantity > MAX_NUMBER_ORDERED) {
			System.out.println("‚ùå Cannot add '" + media.getTitle() + "'. The cart is full now.");
			return;
		}
		
		itemsOrdered.put(media, itemsOrdered.getOrDefault(media, 0) + quantity);
		System.out.println("You've added " + quantity + "items '" + media.getTitle() + "' to cart.");
	}
	
	public void removeMedia(Media media) {
		if (media == null) {
			System.out.println("‚ùå Invalid media.");
			return;
		}
		
		if (itemsOrdered.containsKey(media)) {
			itemsOrdered.remove(media);
			System.out.println("Deleted '" + media.getTitle() + "' from cart.");
		} else {
			System.out.println("‚ùå Item '" + media.getTitle() + "' does not exist in current cart.");
		}
	}
	
	public void updateQuantity(Media media, int newQuantity) {
		if (media == null || newQuantity < 0) {
			System.out.println("‚ùå Invalid item or invalid quantity.");
			return;
		}
		
		if(!itemsOrdered.containsKey(media)) {
			System.out.println("‚ùå Item '" + media.getTitle() + "'does not exist in current cart.");
			return;
		}
		
		if (newQuantity == 0) {
			this.removeMedia(media);
			return;
		}
		
		int currentTotal = getTotalItems() - itemsOrdered.get(media) + newQuantity;
		if (currentTotal > MAX_NUMBER_ORDERED) {
			System.out.println("‚ùå Cannot update the quantity of '" + media.getTitle() + "' to " + newQuantity + ". The cart will be full.");
			return;
		}
		
		itemsOrdered.put(media, newQuantity);
		System.out.println("Updated: '" + media.getTitle() + "' to " + newQuantity + "items.");
	}
	
	public double totalCost() {
		double total = 0;
		for (Map.Entry<Media, Integer> entry : itemsOrdered.entrySet()) {
			double cost = entry.getKey().getCost();
			int quantity = entry.getValue();
			total += cost * quantity;
		}
		return total;
	}
	
	public void searchItemsByTitle(String keyword) {
		if (keyword == null || keyword.trim().isEmpty()) {
			System.out.println("‚ùå Keyword is invalid");
			return;
		}
		
		String lowerCaseKeyword = keyword.toLowerCase();
		boolean found = false;
		
		System.out.println("üîç See the result(s) when you search for '" + keyword + "':");
		
		for (Map.Entry<Media, Integer> entry : itemsOrdered.entrySet()) {
			String title = entry.getKey().getTitle().toLowerCase();
			double cost = entry.getKey().getCost();
			int quantity = entry.getValue();
			
			if (title.contains(lowerCaseKeyword)) {
				System.out.println("- " + entry.getKey().getTitle() + " (Cost: " + cost + "$, Quantity: " + quantity + ") => Total: " + cost * quantity + "$");
				found = true;
			}
		}
		
		if (!found) {
			System.out.println("‚ùå Cannot find.");
		}
	}
	
	public void sort
	
	public void show() {
		System.out.println();
		System.out.println("=== THE CURRENT CART ===");
		for (Map.Entry<Media, Integer> entry : itemsOrdered.entrySet() ) {
			double cost = entry.getKey().getCost();
			int quantity = entry.getValue();
			System.out.println("- " + entry.getKey().getTitle() + " (Cost: " + cost + "$, Quantity: " + entry.getValue() + ") => Total: " + cost * quantity + "$");
		}
		System.out.println("TOTAL COST: " + this.totalCost());
		System.out.println();
	}
	
	private int getTotalItems() {
		int total = 0;
		for (int quantity : itemsOrdered.values()) {
			total += quantity;
		}
		return total;
	}
}
